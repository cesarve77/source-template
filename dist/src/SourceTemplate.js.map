{"version":3,"sources":["../../src/SourceTemplate.js"],"names":["SourceTemplate","state","data","props","template","showForm","editTemplate","getCode","onCopy","output","form","submit","onDownload","onSubmit","onDataChange","Promise","resolve","onSubmitSuccess","sourceCode","element","document","createElement","setAttribute","encodeURI","name","click","then","console","log","catch","err","error","hideForm","setState","autoForm","onChange","e","captureCopy","copied","length","code","nextProps","userData","allowEdit","onTemplateChange","height","width","display","$blockScrolling","defaultProps","mode","theme","fontSize","showPrintMargin","showGutter","highlightActiveLine","propTypes","string","isRequired","object","func","bool"],"mappings":"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","file":"SourceTemplate.js","sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types'\nimport {AutoForm, AutoFields, ErrorsField} from \"./AutoForm\";\nimport {Wrapper, Button} from './StyledComponets'\nimport AceEditor from 'react-ace'\nimport 'brace/mode/javascript';\nimport 'brace/theme/github';\nimport {copyTextToClipboard, getSchema, removeComments, solveTemplate} from \"./utils\";\n\n\nclass SourceTemplate extends Component {\n\n    state = {data: this.props.data, template: this.props.template, showForm: false, editTemplate: !this.props.data}\n\n    componentWillReceiveProps(nextProps) {\n        const {userData} = nextProps\n        if (userData) {\n            this.setState({userData})\n        }\n    }\n\n    getCode = (data) => {\n        return solveTemplate(this.state.template, data)\n    }\n\n    onCopy = () => {\n        this.output = 'copy'\n        this.form.submit()\n    }\n    onDownload = () => {\n        this.output = 'download'\n        this.form.submit()\n    }\n    onSubmit = (data) => {\n        const {onDataChange} = this.props\n        onDataChange && onDataChange(data)\n        return Promise.resolve(this.getCode())\n    }\n    onSubmitSuccess = (sourceCode) => {\n\n        if (this.output === 'download') {\n            const element = document.createElement('a');\n            element.setAttribute('href', 'data:text/text;charset=utf-8,' + encodeURI(removeComments(sourceCode)));\n            element.setAttribute('download', this.props.name);\n            element.click();\n        } else {\n            copyTextToClipboard(removeComments(sourceCode)).then(() => console.log('copied')).catch((err) => console.error(err))\n        }\n        this.hideForm()\n\n\n    }\n    hideForm = () => {\n        this.setState({showForm: false})\n    }\n    autoForm = () => {\n        const {template, data} = this.state\n        return (\n            <Wrapper onCopy={this.onCopy} onDownload={this.onDownload} onClose={this.hideForm}>\n                <AutoForm\n                    ref={form => this.form = form}\n                    schema={getSchema(template)}\n                    model={{data}}\n                    onSubmit={this.onSubmit}\n                    onSubmitSuccess={this.onSubmitSuccess}\n                >\n                    <AutoFields />\n                    <ErrorsField/>\n                    <br/>\n\n                </AutoForm>\n            </Wrapper>\n        )\n    }\n\n    onChange = (template, e) => {\n        this.setState({template})\n        const {onDataChange, onChange} = this.props\n        onDataChange && onDataChange(template, e)\n        onChange && onChange(template, e)\n    }\n    captureCopy = (copied) => {\n        if (copied.length === this.code.length) this.showForm()\n    }\n    showForm = () => {\n        this.setState({showForm: true})\n    }\n\n    render() {\n        const {template, showForm, editTemplate} = this.state\n        const {data, allowEdit, ...props} = this.props\n        delete props.template\n        delete props.onDataChange\n        delete props.onTemplateChange\n        return (\n            <div style={{height: props.height, width: props.width}}>\n                <AceEditor\n                    style={{display: `${!showForm && !editTemplate ? '' : 'none'}`}}\n                    editorProps={{$blockScrolling: true}}\n                    {...props}\n                    onChange={this.onChange}\n                    readOnly\n                    value={this.getCode(data)}\n                    onCopy={this.captureCopy}\n                />\n                {allowEdit && <AceEditor\n                    style={{display: `${!showForm && editTemplate ? '' : 'none'}`}}\n                    onChange={this.onChange}\n                    editorProps={{$blockScrolling: true}}\n                    {...props}\n                    value={template}\n                />}\n                <br/>\n                {allowEdit && !showForm && !editTemplate && <Button onClick={() => this.setState({editTemplate: true})}>Edit template</Button>}\n                {!showForm && editTemplate && <Button onClick={() => this.setState({editTemplate: false})}>Show code</Button>}\n                {!showForm && <Button onClick={this.showForm}>Get code</Button>}\n                {showForm && this.autoForm()}\n            </div>\n\n        )\n    }\n\n    static defaultProps = {\n        name: 'file.js',\n        mode: \"javascript\",\n        theme: \"github\",\n        allowEdit: true,\n        fontSize: 14,\n        showPrintMargin: true,\n        showGutter: true,\n        highlightActiveLine: true,\n        height: '500px',\n        width: '100%'\n    }\n    static propTypes = {\n        template: PropTypes.string.isRequired,\n        data: PropTypes.object,\n        onDataChange: PropTypes.func,\n        onTemplateChange: PropTypes.func,\n        allowEdit: PropTypes.bool,\n\n    }\n}\n\nexport default SourceTemplate\n"]}